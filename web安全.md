# web安全

## 一.信息收集

### 1.域名信息收集

#### 1.1.1Whois查询

whois用于查询域名是否已被注册以及注册域名的详细信息的数据库

whois可以查询到注册人的姓名和邮箱信息

```
kali
whois 地址
```

可以获得域名服务商，域名拥有者，邮箱，电话，地址。

#### 1.1.2备案信息查询

国内网站备案为法律规定

ICP备案查询网站：www.beianbeia.com

天眼查：www.tianyancha.com

### 2.收集敏感信息

| 关键字   | 说明                                              |
| -------- | ------------------------------------------------- |
| Site     | 指定域名                                          |
| Inurl    | URL中存在关键字的网页                             |
| Intext   | 网页正文中的关键字                                |
| Filetype | 指定文件类型                                      |
| Intitle  | 网页标题中的关键字                                |
| link     | link：baidu.com即返回所有和baidu.com做了链接的URL |
| Info     | 查找指定站点的一些基本信息                        |
| cache    | 搜索Google里关于某些内容的缓存                    |

例子：

```
site:edu.cn intext:后台管理
```

意思：搜索网页正文中含有“后台管理”并且域名后缀是edu.cn的网站

### 3.收集子域名信息

子域名就是二级域名，顶级域名下的域名。

#### 1.子域名检测工具

工具：Layer子域名挖掘机，K8，wydomain，Sublist3r,dnsmaper,subDomainsBrute,Maltego CE

重点推荐：==Layer子域名挖掘机，Sublist3r和subDomainBrute==

Layer子域名挖掘机的使用方法比较简单，在域名对话框中直接输入域名就可以进行扫描，它的显示界面比较细致，有域名、解析IP、CDN列表、Web服务器和网站状态.

subDomainsBrute的特点是可以用小字典递归地发现三级域名、四级域名，甚至五级域名等不容易被探测到的域名。执行该工具的命令如下所示。

```
python subDomainsbrute.py xxx.com
```

Sublist3r也是一个比较常用的工具，它能列举多种资源，如在Google、Yahoo、Bing、Baidu和Ask等搜索引擎中可查到的子域名，还可以列出Netcraft、VirusTotal、ThreatCrowd、DNSdumpster和Reverse DNS查到的子域名。

#### 2.搜索引擎枚举

通过Google语法搜索子域名

例如搜索百度旗下的子域名：

```
site: baidu.com
```

第三方聚合应用枚举

读者也可以利用DNSdumpster网站（https://dnsdumpster.com/）、在线DNS侦查和搜索的工具挖掘出指定域潜藏的大量子域。

#### 3.证书透明度公开日志枚举

一个SSL、LTS证书通常包含域名，子域名和邮件地址查询公开的CT日志

笔者推荐crt.sh:https://crt.sh和censys:https://censys.io这两个网站。

### 4.收集常用端口信息

在渗透测试的过程中，对端口信息的收集是一个很重要的过程，通过扫描服务器开放的端口以及从该端口判断服务器上存在的服务，就可以对症下药，便于我们渗透目标服务器。

所以在端口渗透信息的收集过程中，我们需要关注常见应用的默认端口和在端口上运行的服务。最常见的扫描工具就是==Nmap==（具体的使用方法后续章节会详细介绍），无状态端口扫描工具Masscan、ZMap和御剑高速TCP端口扫描工具。

常见的端口及其说明，以及攻击方向汇总

文件共享服务端口

|  端口号  | 端口说明             | 攻击方向                         |
| :------: | -------------------- | -------------------------------- |
| 21/22/69 | Ftp/Tftp文件传输协议 | 允许匿名的上传，下载，爆破和嗅探 |
|   2049   | Nfs服务              | 配置不当                         |
|   139    | Samba服务            | 爆破，为授权访问，远程代码执行   |
|   389    | Ldap目录访问协议     | 注入，允许匿名访问，弱口令       |

远程连接服务端口

| 端口号 | 端口说明         | 攻击方向                                |
| ------ | ---------------- | --------------------------------------- |
| 22     | SSH远程连接      | 爆破，SSH隧道以及内网代理转发，文件传输 |
| 23     | Telnet远程连接   | 爆破，嗅探，弱口令                      |
| 3389   | Radp远程桌面连接 | Shift后门，爆破                         |
| 5900   | VNC              | 弱口令爆破                              |
| 5632   | PyAnywhere服务   | 抓密码，代码执行                        |

Web应用服务端口

| 端口号      | 端口说明                  | 攻击方向                          |
| ----------- | ------------------------- | --------------------------------- |
| 80/443/8080 | 常见的Web服务端口         | Web攻击，爆破，对应服务器版本漏洞 |
| 7001/7002   | WebLogic控制台            | Java反序列化，弱口令              |
| 8080/8089   | Jboss/Resin/Jetty/Jenkins | 反序列化，控制台弱口令            |
| 9090        | WebSphere控制台           | Java反序列化                      |
| 4848        | GlassFish控制台           | 弱口令                            |
| 1352        | Lotus domino 邮件服务     | 弱口令，星系泄露，爆破            |
| 10000       | Webmin-Web控制面板        | 弱口令                            |

数据库服务端口

| 端口号      | 端口说明    | 攻击方向                   |
| ----------- | ----------- | -------------------------- |
| 3306        | MYSQL       | 注入，提取，爆破           |
| 1433        | MSSQL       | 注入，提取，SA弱口令，爆破 |
| 1521        | Oracle      | TNS爆破，注入，反弹Shell   |
| 5432        | PostgreSQL  | 爆破，注入，弱口令         |
| 27017/27018 | MongoDB     | 爆破，未授权访问           |
| 6379        | Redis       | 未授权访问，弱口令爆破     |
| 5000        | SysBase/DB2 | 爆破，注入                 |

邮件服务端口

| 端口号 | 端口说明     | 攻击方向   |
| ------ | ------------ | ---------- |
| 25     | SMTP邮件服务 | 有机胺伪造 |
| 110    | POPS协议     | 爆破，嗅探 |
| 143    | IMAP协议     | 爆破       |

#### 5.指纹识别

网站CMS指纹识别，计算机操作系统以及web容器的指纹识别

CMS（Content Management System）又称整站系统或文章系统。在2004年以前，如果想进行网站内容管理，基本上都靠手工维护，但在信息爆炸的时代，完全靠手工完成会相当痛苦。所以就出现了CMS，开发者只要给客户一个软件包，客户自己安装配置好，就可以定期更新数据来维护网站，节省了大量的人力和物力。

#### 6.查找真实IP



## 二.漏洞发现

### 1.漏洞问题

### 2.WEB漏洞

#### 1.漏洞分类：

sql注入 xss跨站 文件上传 代码执行 文件包含等

#### 2.漏洞影响：

漏洞可以干啥，可以实现什么目的

#### 3.漏洞扫描

AwWS appscan Netsparker等

### 3.系统漏洞

## 三.WEB安全原理刨析

### 1.SQL注入基础

#### 1.SQL注入介绍

SQL注入就是指Web应用程序对用户输入数据的合法性没有判断，前端传入后端的参数是攻击者可控的，并且参数带入数据库查询，攻击者可以通过构造不同的SQL语句来实现对数据库的任意操作。

#### 2.SQL注入的原理

##### 1.参数可控

前端传入后端的参数是用户可以控制的。

##### 2.参数代入数据库查询

传入的参数拼接到SQL语句，且带入数据库查询。

#### 3.MYSQL查询语句

在不知道任何条件时，语句如下所示。
SELECT 要查询的字段名FROM库名.表名

在知道一条已知条件时，语句如下所示。
SELECT 要查询的字段名FROM库名.表名WHERE已知条件的字段名=’已知条件的值‘

在知道两条已知条件时，语句如下所示。

SLELCT 要查询的字段名 FROM 库名.表名 WHERE 已知条件1的字段名 = '已知条件1的值'  AND 已知条件2 的字段名=‘ 已知条件2的值’

#### 4.limit的用法

limit的使用格式为limit m，n，其中m是指记录开始的位置，从0开始，表示第一条记录；n是指取n条记录。例如limit 0，1表示从第一条记录开始，取一条记录。

#### 5.主要用到的函数

database() ：当前网站使用的数据库

version():当前MYSQL的版本

user():当前MYSQL的用户

#### 4.注样符

在MySQL中，常见注释符的表达方式：#或——空格或/**/。

#### 5.内联注释的形式：

/*！code*/。内联注释可以用于整个SQL语句中，用来执行我们的SQL语句，下面举一个例子
index.php？id=-15/*！UNION*//*！SELECT*/1，2，3。